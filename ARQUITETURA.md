# ğŸ—ï¸ ARQUITETURA - Wtm Corps FinanÃ§as v2.0

## ğŸ“Š Diagrama de Fluxo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USUÃRIO                                   â”‚
â”‚                    (Seu Cliente)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       NEXT.JS FRONTEND                 â”‚
        â”‚  (React + Tailwind CSS)                â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Pages:                          â”‚ â”‚
        â”‚  â”‚  - /login (AutenticaÃ§Ã£o)        â”‚ â”‚
        â”‚  â”‚  - /register (Registro)         â”‚ â”‚
        â”‚  â”‚  - /dashboard (Dashboard)       â”‚ â”‚
        â”‚  â”‚  - /chat (Chat com IA)          â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Components:                     â”‚ â”‚
        â”‚  â”‚  - Chat.tsx (Realtime)          â”‚ â”‚
        â”‚  â”‚  - AuthHeader                   â”‚ â”‚
        â”‚  â”‚  - Dashboard Cards              â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                        â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Contexts:                       â”‚ â”‚
        â”‚  â”‚  - AuthContext (useAuth hook)   â”‚ â”‚
        â”‚  â”‚  - useAuth()                    â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚              â”‚
    â–¼                           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API ROUTES â”‚         â”‚  MIDDLEWARE   â”‚  â”‚ ENVIRONMENT  â”‚
â”‚ /api/*      â”‚         â”‚ middleware.ts â”‚  â”‚  Variables   â”‚
â”‚             â”‚         â”‚               â”‚  â”‚              â”‚
â”‚ â”œâ”€ /chat    â”‚         â”‚ - ProteÃ§Ã£o    â”‚  â”‚ â”œâ”€ API Keys  â”‚
â”‚ â”‚ (OpenAI)  â”‚         â”‚ - Auth check  â”‚  â”‚ â”‚ (OpenAI)   â”‚
â”‚ â”‚           â”‚         â”‚ - Redirect    â”‚  â”‚ â”‚            â”‚
â”‚ â”œâ”€ /auth    â”‚         â”‚               â”‚  â”‚ â”œâ”€ DB Creds  â”‚
â”‚ â”‚ (Supabase)â”‚         â”‚ Protege:      â”‚  â”‚ â”‚ (Supabase) â”‚
â”‚ â”‚ - login   â”‚         â”‚ â”œâ”€/dashboard  â”‚  â”‚ â”‚            â”‚
â”‚ â”‚ - registerâ”‚         â”‚ â”œâ”€/profile    â”‚  â”‚ â””â”€ Config    â”‚
â”‚ â”‚           â”‚         â”‚ â”œâ”€/settings   â”‚  â”‚   URLs       â”‚
â”‚ â””â”€ Others   â”‚         â”‚ â””â”€ etc        â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚          â”‚                        â”‚
       â–¼          â–¼                        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ OPENAI API           â”‚        â”‚ SUPABASE        â”‚
   â”‚ (InteligÃªncia)       â”‚        â”‚ (Banco de Dados)â”‚
   â”‚                      â”‚        â”‚                 â”‚
   â”‚ gpt-4o-mini          â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ - Chat financeiro    â”‚        â”‚ â”‚ Database:   â”‚ â”‚
   â”‚ - Especialista BR    â”‚        â”‚ â”‚ - users     â”‚ â”‚
   â”‚ - Respostas IA       â”‚        â”‚ â”‚ - chats     â”‚ â”‚
   â”‚ - AnÃ¡lises           â”‚        â”‚ â”‚ - messages  â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚             â”‚ â”‚
   â”‚ Custo:               â”‚        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
   â”‚ ~$0.03-0.05 por chat â”‚        â”‚ â”‚ Auth:       â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - JWT       â”‚ â”‚
   â”‚ Limite:              â”‚        â”‚ â”‚ - Email     â”‚ â”‚
   â”‚ Use billing limit!   â”‚        â”‚ â”‚ - Password  â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚             â”‚ â”‚
   â”‚                      â”‚        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
   â”‚                      â”‚        â”‚ â”‚ Realtime:   â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - WebSocket â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - Live      â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚   update    â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚             â”‚ â”‚
   â”‚                      â”‚        â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
   â”‚                      â”‚        â”‚ â”‚ Security:   â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - RLS       â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - Policies  â”‚ â”‚
   â”‚                      â”‚        â”‚ â”‚ - Encrypted â”‚ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  VERCEL         â”‚
                    â”‚  (Deploy)       â”‚
                    â”‚                 â”‚
                    â”‚ Seu site online:â”‚
                    â”‚ seu-app.        â”‚
                    â”‚ vercel.app      â”‚
                    â”‚                 â”‚
                    â”‚ SSL/HTTPS:      â”‚
                    â”‚ âœ… AutomÃ¡tico   â”‚
                    â”‚                 â”‚
                    â”‚ CI/CD:          â”‚
                    â”‚ âœ… Auto build   â”‚
                    â”‚    e deploy     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxo de Uma Conversa (Chat)

```
1. USUÃRIO ESCREVE MENSAGEM
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                         â”‚
                                         â–¼
2. FRONTEND ENVIA PARA /api/chat
   - message: "Como investir em CDB?"
   - userId: "uuid-123"
   - chatId: "uuid-456"
   - history: [...]
                                         â”‚
                                         â–¼
3. API ROUTE (/app/api/chat/route.ts)
   â”œâ”€ Salva mensagem do usuÃ¡rio no Supabase
   â”‚
   â”œâ”€ Monta context para OpenAI:
   â”‚  - System prompt (assistente financeiro)
   â”‚  - HistÃ³rico de conversa
   â”‚  - Mensagem do usuÃ¡rio
   â”‚
   â””â”€ Chama OpenAI GPT-4o-mini
                                         â”‚
                                         â–¼
4. OPENAI RESPONDE
   â””â”€ "Um CDB Ã© um investimento de renda..."
                                         â”‚
                                         â–¼
5. API SALVA RESPOSTA NO SUPABASE
   â””â”€ Supabase dispara evento em tempo real
                                         â”‚
                                         â–¼
6. FRONTEND RECEBE VIA REALTIME
   â””â”€ Chat.tsx atualiza automaticamente
      (Sem refresh!)
                                         â”‚
                                         â–¼
7. USUÃRIO VÃŠ A RESPOSTA
   â””â”€ Conversa foi salva no BD
      para histÃ³rico futuro
```

---

## ğŸ—‚ï¸ Estrutura de Pastas (Simplified)

```
Site Wtm corps finanÃ§as/
â”‚
â”œâ”€â”€ ğŸ“„ LEIA_PRIMEIRO.md â­ COMECE AQUI
â”‚
â”œâ”€â”€ ğŸ“š DocumentaÃ§Ã£o/
â”‚   â”œâ”€â”€ QUICK_START.md ............ 2 min para rodar
â”‚   â”œâ”€â”€ SETUP_COMPLETO.md ........ Setup Supabase + Vercel
â”‚   â”œâ”€â”€ SEGURANCA.md ............ Guia de seguranÃ§a
â”‚   â”œâ”€â”€ ATUALIZACOES.md ........ O que foi feito
â”‚   â”œâ”€â”€ ESTRUTURA.md ........... Arquitetura
â”‚   â”œâ”€â”€ README_EXECUTIVO.md ..... Para apresentaÃ§Ãµes
â”‚   â”œâ”€â”€ ENTREGA.md ............ Checklist
â”‚   â””â”€â”€ EXEMPLOS_USO.tsx ..... Exemplos de cÃ³digo
â”‚
â”œâ”€â”€ ğŸ” SeguranÃ§a/
â”‚   â”œâ”€â”€ .env.local ......... Suas credenciais (NÃƒO COMMITAR)
â”‚   â”œâ”€â”€ .env.example ...... Template
â”‚   â””â”€â”€ .gitignore ....... ProteÃ§Ã£o
â”‚
â”œâ”€â”€ ğŸš€ AutomaÃ§Ã£o/
â”‚   â”œâ”€â”€ setup.ps1 ........ Script Windows
â”‚   â””â”€â”€ setup.sh ....... Script Linux/Mac
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/chat/route.ts ....... ChatBot OpenAI â­
â”‚   â”‚   â”œâ”€â”€ api/auth/.../......... AutenticaÃ§Ã£o
â”‚   â”‚   â””â”€â”€ [pages]/.............. PÃ¡ginas
â”‚   â”‚
â”‚   â”œâ”€â”€ components/ai/
â”‚   â”‚   â””â”€â”€ Chat.tsx ........... Component chat realtime â­
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext-new.tsx .. AutenticaÃ§Ã£o Supabase â­
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ supabase.ts ....... ConexÃ£o DB â­
â”‚   â”‚
â”‚   â””â”€â”€ [outros]/
â”‚       â””â”€â”€ [componentes existentes]
â”‚
â”œâ”€â”€ âš™ï¸ ConfiguraÃ§Ã£o/
â”‚   â”œâ”€â”€ package.json ........ DependÃªncias (ATUALIZADO)
â”‚   â”œâ”€â”€ next.config.js ..... Config Next.js
â”‚   â”œâ”€â”€ tsconfig.json ...... Config TypeScript
â”‚   â”œâ”€â”€ tailwind.config.ts .. Tailwind CSS
â”‚   â””â”€â”€ postcss.config.js .. PostCSS
â”‚
â””â”€â”€ middleware.ts ......... ProteÃ§Ã£o de rotas â­
```

---

## ğŸ“¡ ComunicaÃ§Ã£o Entre Camadas

### Frontend â†’ Backend
```typescript
// src/components/ai/Chat.tsx
const response = await fetch("/api/chat", {
  method: "POST",
  body: JSON.stringify({
    message: "Qual a melhor estratÃ©gia?",
    userId: user.id,
    chatId: chatId,
  })
});
// Resposta: OpenAI + Banco de Dados atualizado
```

### Backend â†’ Database
```typescript
// src/app/api/chat/route.ts
const { data } = await supabaseAdmin
  .from("messages")
  .insert({
    chat_id: chatId,
    user_id: userId,
    sender: "assistant",
    text: aiMessage,
  });
// Supabase envia evento em tempo real
```

### Database â†’ Frontend (Realtime)
```typescript
// src/components/ai/Chat.tsx
const subscription = supabase
  .channel(`messages:${chatId}`)
  .on("postgres_changes", {...}, (payload) => {
    setMessages(prev => [...prev, payload.new]);
  })
  .subscribe();
// Mensagem aparece INSTANTANEAMENTE!
```

---

## ğŸ” Fluxo de AutenticaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UsuÃ¡rio Faz Login   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ /login page  â”‚
    â”‚ (Frontend)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ useAuth().login()    â”‚
    â”‚ (Email + Password)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Supabase.auth.signIn()       â”‚
    â”‚ (AuthContext-new.tsx)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Supabase Auth Server         â”‚
    â”‚ - Verifica email/password    â”‚
    â”‚ - Gera JWT token            â”‚
    â”‚ - Retorna session           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UsuÃ¡rio Autenticado!         â”‚
    â”‚ - JWT token no cliente       â”‚
    â”‚ - Session armazenada         â”‚
    â”‚ - Redireciona para dashboard â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Middleware verifica:         â”‚
    â”‚ - Tem token?                 â”‚
    â”‚ - Token vÃ¡lido?              â”‚
    â”‚ - PermissÃ£o para rota?       â”‚
    â”‚                              â”‚
    â”‚ âœ… Acesso liberado           â”‚
    â”‚ âŒ Redireciona para login    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Estrutura do Banco de Dados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SUPABASE POSTGRESQL             â”‚
â”‚         (Banco de Dados na Nuvem)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚              â”‚
    â–¼                    â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USERS   â”‚         â”‚ CHATS   â”‚   â”‚ MESSAGES â”‚
â”‚          â”‚         â”‚         â”‚   â”‚          â”‚
â”‚ â”œâ”€ id    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€ user_idâ”‚   â”‚ â”œâ”€ id    â”‚
â”‚ â”œâ”€ email â”‚         â”‚ â”œâ”€ id   â”‚â”€â”€â”â”‚ â”œâ”€ chat_ â”‚
â”‚ â”œâ”€ name  â”‚         â”‚ â”œâ”€ titleâ”‚  â””â”€ id      â”‚
â”‚ â”œâ”€ phone â”‚         â”‚ â””â”€ ts   â”‚   â”‚ â”œâ”€ senderâ”‚
â”‚ â”œâ”€ incomeâ”‚         â”‚         â”‚   â”‚ â”œâ”€ text  â”‚
â”‚ â””â”€ ts    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€ ts    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ RLS Policies   â”‚
                    â”‚ (SeguranÃ§a)    â”‚
                    â”‚                â”‚
                    â”‚ UsuÃ¡rio sÃ³     â”‚
                    â”‚ acessa seus    â”‚
                    â”‚ prÃ³prios dados â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deploy Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ³digo Local       â”‚
â”‚ (seu computador)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ git push
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repository  â”‚
â”‚ (seu cÃ³digo)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ webhook automÃ¡tico
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel CI/CD       â”‚
â”‚ (automÃ¡tico)       â”‚
â”‚                    â”‚
â”‚ 1. Pull cÃ³digo     â”‚
â”‚ 2. npm install     â”‚
â”‚ 3. npm run build   â”‚
â”‚ 4. Deploy!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEU SITE AO VIVO! ğŸ‰       â”‚
â”‚                            â”‚
â”‚ https://seu-app.vercel.app â”‚
â”‚ + HTTPS automÃ¡tico         â”‚
â”‚ + CDN global               â”‚
â”‚ + Backups automÃ¡ticos      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Ciclo de Desenvolvimento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Desenvolvimento Local â”‚
â”‚    npm run dev           â”‚
â”‚    localhost:3000        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Teste Local           â”‚
â”‚    - Chatbot funciona?   â”‚
â”‚    - Login/Register OK?  â”‚
â”‚    - Dados salvos?       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Build para ProduÃ§Ã£o   â”‚
â”‚    npm run build         â”‚
â”‚    Verifica erros        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Commit & Push         â”‚
â”‚    git commit            â”‚
â”‚    git push              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Deploy AutomÃ¡tico     â”‚
â”‚    Vercel faz o trabalho â”‚
â”‚    (2-3 minutos)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Site Online! ğŸš€       â”‚
â”‚    vercel.app            â”‚
â”‚    Compartilhe com mundo â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Resumo Visual

```
         FRONTEND (Next.js)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  React Components   â”‚
    â”‚  Tailwind CSS       â”‚
    â”‚  TypeScript         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API    â”‚   â”‚ Middlewareâ”‚
    â”‚/chat   â”‚   â”‚ProteÃ§Ã£o   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚          â”‚
        â–¼                     â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OPENAI API â”‚       â”‚SUPABASE â”‚  â”‚ENV VARS  â”‚
    â”‚ (IA)       â”‚       â”‚(DB)     â”‚  â”‚(Config)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ VERCEL  â”‚
                  â”‚(Deploy) â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ Fluxo de Uso (UsuÃ¡rio Final)

```
1. UsuÃ¡rio acessa seu site
   â””â”€â†’ VÃª pÃ¡gina de login

2. Faz login
   â””â”€â†’ Middleware valida
   â””â”€â†’ JWT token criado
   â””â”€â†’ Redireciona para dashboard

3. Acessa chat
   â””â”€â†’ Component Chat.tsx carrega
   â””â”€â†’ HistÃ³rico baixado do banco

4. Escreve mensagem
   â””â”€â†’ Envia para /api/chat
   â””â”€â†’ OpenAI processa
   â””â”€â†’ Resposta salva no BD

5. VÃª resposta em tempo real
   â””â”€â†’ Realtime atualiza chat
   â””â”€â†’ Sem refresh necessÃ¡rio

6. Faz logout
   â””â”€â†’ JWT token removido
   â””â”€â†’ Redireciona para login
```

---

**Este Ã© o projeto v2.0 em toda sua glÃ³ria!** ğŸ‰

Diagrama criado em ASCII para sua referÃªncia.

**Ãšltima AtualizaÃ§Ã£o:** 4 de Dezembro de 2025
**Status:** âœ… PRODUCTION READY
